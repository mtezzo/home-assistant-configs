################################################################
## Packages / Z-Wave Remotes
################################################################

################################################
## Customize
################################################

homeassistant:
  customize:
    ################################################
    ## Node Anchors
    ################################################

    package.node_anchors:
      customize: &customize
        package: 'zwave_remotes'

      expose: &expose
        <<: *customize
        homebridge_hidden: false

    ################################################
    ## Automation
    ################################################

    automation.keyfob_circle_button_tapped:
      <<: *customize
      friendly_name: "Circle Button Tap Nightstand Light On"
      icon: mdi:circle-outline

    automation.keyfob_square_button_tapped:
      <<: *customize
      friendly_name: "Square Button Tap Nightstand Light Off"
      icon: mdi:square-outline

    automation.keyfob_triangle_button_tapped:
      <<: *customize
      friendly_name: "Tringle Button Tap Dresser Light On"
      icon: mdi:triangle-outline

    automation.keyfob_x_button_tapped:
      <<: *customize
      friendly_name: "X Button Tap Dresser Light Off"
      icon: mdi:window-close

    automation.keyfob_minus_button_tapped:
      <<: *customize
      friendly_name: "Minus Button Tap Bedroom Motion Off"
      icon: mdi:minus

    automation.keyfob_minus_button_held:
      <<: *customize
      friendly_name: "Minus Button Hold Night Mode On"
      icon: mdi:minus

    automation.keyfob_plus_button_tapped:
      <<: *customize
      friendly_name: "Plus Button Tap Bedroom Motion On"
      icon: mdi:plus

    automation.nightstand_switches:
      <<: *customize
      friendly_name: "Bedroom Nightstand Switch Light Control"
      icon: mdi:light-switch

################################################
## Automation
################################################

automation:

  ################################################
  ## Circle/Square Button
  ################################################

  - alias: keyfob_circle_button_tapped
    initial_state: true
    trigger:
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 18
          property_key: '002'
          value: 'KeyPressed'
          # scene_data: 7680
    action:
      - service: light.turn_on
        target:
          entity_id: light.nightstand_lamp
        data:
          brightness_pct: 70
          color_temp: 370
          transition: 2

  - alias: keyfob_square_button_tapped
    initial_state: true
    trigger:
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 18
          property_key: '001'
          value: 'KeyPressed'
          # scene_data: 7680
    action:
      - service: light.turn_off
        target:
          entity_id: light.nightstand_lamp
        data:
          transition: 2

  ################################################
  ## Triangle/X Button
  ################################################

  - alias: keyfob_triangle_button_tapped
    initial_state: true
    trigger:
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 18
          property_key: '004'
          value: 'KeyPressed'
          # scene_data: 7680
    action:
      - service: light.turn_on
        target:
          entity_id: light.dresser_lamp
        data:
          brightness_pct: 70
          color_temp: 370
          transition: 2

  - alias: keyfob_x_button_tapped
    initial_state: true
    trigger:
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 18
          property_key: '003'
          value: 'KeyPressed'
          # scene_data: 7680
    action:
      - service: light.turn_off
        target:
          entity_id: light.dresser_lamp
        data:
          transition: 2

  ################################################
  ## Minus Button
  ################################################

  - alias: keyfob_minus_button_tapped
    initial_state: true
    trigger:
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 18
          property_key: '005'
          value: 'KeyPressed'
          # scene_data: 7680
    action:
      - service: automation.turn_off
        data:
          entity_id:
            - automation.master_bedroom_motion

  - alias: keyfob_minus_button_held
    initial_state: true
    trigger:
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 18
          property_key: '005'
          value: 'KeyHeldDown'
          # scene_data: 7800
    action:
      - service: alarm_control_panel.alarm_arm_night
        entity_id: alarm_control_panel.alarm_system
        data:
          code: !secret alarm_code

  ################################################
  ## Plus Button
  ################################################

  - alias: keyfob_plus_button_tapped
    initial_state: true
    trigger:
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 18
          property_key: '006'
          value: 'KeyPressed'
          # scene_data: 7680
    action:
      - service: automation.turn_on
        data:
          entity_id:
            - automation.master_bedroom_motion

  ################################################
  ## Switch Activated Lights
  ################################################

  - alias: nightstand_switches
    initial_state: true
    trigger:
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 30
      - platform: event
        event_type: zwave_js_value_notification
        event_data:
          node_id: 31
    action:
      - choose:
        # If Top button 1x
        - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.label == 'Scene 001' and trigger.event.data.value == 'KeyPressed' }}"
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.dresser_lamp, light.nightstand_lamp
              data:
                brightness_pct: 100
                color_temp: 370
                transition: 2
        # If Top button 2x
        - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.label == 'Scene 001' and trigger.event.data.value == 'KeyPressed2x' }}"
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.dresser_lamp, light.nightstand_lamp
              data:
                brightness_pct: 70
                color_temp: 370
                transition: 2
        # If Top button 3x
        - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.label == 'Scene 001' and trigger.event.data.value == 'KeyPressed3x' }}"
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.dresser_lamp, light.nightstand_lamp
              data:
                brightness_pct: 50
                color_temp: 370
                transition: 2
        # If Top button 4x
        - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.label == 'Scene 001' and trigger.event.data.value == 'KeyPressed4x' }}"
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.dresser_lamp, light.nightstand_lamp
              data:
                brightness_pct: 30
                color_temp: 370
                transition: 2
        # If Top button 5x
        - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.label == 'Scene 001' and trigger.event.data.value == 'KeyPressed5x' }}"
          sequence:
            - service: light.turn_on
              target:
                entity_id: light.dresser_lamp, light.nightstand_lamp
              data:
                brightness_pct: 10
                color_temp: 370
                transition: 2
        # If Bottom button 1x
        - conditions:
          - condition: template
            value_template: "{{ trigger.event.data.label == 'Scene 002' and trigger.event.data.value == 'KeyPressed' }}"
          sequence:
            - service: light.turn_off
              target:
                entity_id: light.dresser_lamp, light.nightstand_lamp
              data:
                transition: 3
